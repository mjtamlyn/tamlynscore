{% extends 'input_arrows.html' %}

{% block scripts %}
<script src="{{ STATIC_URL }}js/jquery-1.7.2.min.js"></script>
<script>
    $.noConflict();
</script>
{{ block.super }}
<script>
    jQuery(document).ready(function ($) {
        $('td input').each(function (i, input) {
            var input = $(input);
            var val = input.val();
            if (val == '0') { val = 'M' }
            if (val == '') { val = '&nbsp' }
            var fake = $('<span>').html(val);
            fake.addClass('fake-input');
            input.after(fake);
            if (i == 0) {
                input.parent().addClass('active');
            }
        });

        var tablePress = function (e) {
            $('table .active').removeClass('active');
            $(this).addClass('active');
        };
        $('table .field').live('touchstart', tablePress);
        $('table .field').live('click', tablePress);

        var buttonPress = function (e) {
            e.preventDefault();
            var input = $('table .active input');
            if (!input.length) {
                return;
            }
            input.attr('value', $(this).attr('data-value'));
            var fake = input.next();
            fake.html($(this).attr('data-value'));
            arrows.updateTotals();
            input.parent().removeClass('active');
            var inputs = $('table input');
            inputs.each(function (i, other_input) {
                if (input.attr('name') == other_input.name) {
                    if (inputs[i+1]) {
                        $(inputs[i+1]).parent().addClass('active');
                    } else {
                        $('.save input').focus();
                    }
                }
            });
        };
        $('.input-buttons .input').live('touchstart', buttonPress);
        $('.input-buttons .input').live('click', buttonPress);
    });
</script>
{% endblock %}

{% block bodyclass %}mobile{% endblock %}

{% block competition_content %}
<div class="module input-arrows">
    <h4>Enter arrow values for boss {{ boss }}, dozen {{ dozen }}</h4>
    <form action="" method="post" autocomplete="off">
        <table class="target">
            <tr>
                <th colspan="2">Archer</th>
                <td colspan="{% if forms.0.forms|length > 6 %}6{% else %}{{ forms.0.forms|length }}{% endif %}"></td>
                {% if forms.0.forms|length > 6 %}
                <th>ET</th>
                <td colspan="6"></td>
                <th>ET</th>
                {% endif %}
                <th>Doz</th>
                <th>Hits</th>
                <th>Golds</th>
                <th>RT</th>
            </tr>
            {% for target in forms %}
            <tr>
                <td>{{ target.target }}</td>
                <td>{{ target.archer }}</td>
                {% for form in target.forms %}
                <td class="field">{{ form.arrow_value }}<span class="hidden">{{ form.is_x.value }}</span></td>
                {% if target.forms|length > 6 and forloop.counter == 6 %}
                <th class="end-total et1">0</th>
                {% endif %}
                {% if forloop.last %}
                {% if target.forms|length > 6 %}
                <th class="end-total et2">0</th>
                {% endif %}
                <th class="doz-total">0</th>
                <th class="hits">0</th>
                <th class="golds">0</th>
                <th class="rt" rel="{{ target.running_total|default:0 }}">{{ target.running_total }}</th>
                {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        <div class="input-buttons">
            <div class="input" data-value="10">10</div>
            <div class="input" data-value="9">9</div>
            <div class="input" data-value="8">8</div>
            <div class="input" data-value="7">7</div>
            <div class="input" data-value="6">6</div>
            <div class="input" data-value="5">5</div>
            <div class="input" data-value="4">4</div>
            <div class="input" data-value="3">3</div>
            <div class="input" data-value="2">2</div>
            <div class="input" data-value="1">1</div>
            <div class="input" data-value="M">M</div>
        </div>
        <div class="save">
            <input type="submit" value="Save" />
        </div>
        {% csrf_token %}
    </form>
    <div class="clear"></div>
</div>
{% endblock %}
